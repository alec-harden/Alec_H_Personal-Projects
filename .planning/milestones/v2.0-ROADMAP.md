# Milestone v2.0: Persistence & Project Management

**Status:** SHIPPED 2026-01-28
**Phases:** 8-12
**Total Plans:** 17

## Overview

Add authentication, project management, BOM persistence, template admin, and CSV import to transform the single-session MVP into a persistent, manageable application.

## Phases

### Phase 8: Authentication Foundation

**Goal**: Users can create accounts and log in securely.
**Depends on**: None (foundation phase)
**Plans**: 4 plans

Plans:
- [x] 08-01-PLAN.md — Database schema and auth dependencies
- [x] 08-02-PLAN.md — Session middleware and TypeScript types
- [x] 08-03-PLAN.md — Signup and login routes
- [x] 08-04-PLAN.md — Logout and layout integration

**Requirements:**
- AUTH-01: User can sign up with email and password
- AUTH-02: User can log in with email and password
- AUTH-03: User session persists across browser refresh
- AUTH-04: User can log out

**Technical Notes:**
- Users and sessions tables added to Drizzle schema
- Password hashing with Argon2 (@node-rs/argon2)
- Session middleware in hooks.server.ts
- /auth/login and /auth/signup routes
- oslo utilities for auth helpers

---

### Phase 9: Project Management

**Goal**: Users can organize their work into named projects.
**Depends on**: Phase 8 (requires authentication)
**Plans**: 3 plans

Plans:
- [x] 09-01-PLAN.md — Project schema and database
- [x] 09-02-PLAN.md — Project CRUD routes
- [x] 09-03-PLAN.md — Projects UI integration

**Requirements:**
- PROJ-01: User can create a named project with description
- PROJ-02: User can view list of their projects
- PROJ-03: User can edit project metadata (name, description, notes)
- PROJ-04: User can delete a project

**Technical Notes:**
- Projects table with userId FK, cascade delete
- /projects route with list and create
- /projects/[id] route for detail, edit, delete
- Dashboard shows 6 most recent projects

---

### Phase 10: BOM Persistence

**Goal**: Users can save and manage generated BOMs within projects.
**Depends on**: Phase 9 (requires projects)
**Plans**: 4 plans

Plans:
- [x] 10-01-PLAN.md — BOM schema and database tables
- [x] 10-02-PLAN.md — Save BOM to project flow
- [x] 10-03-PLAN.md — View saved BOMs in project
- [x] 10-04-PLAN.md — Edit and delete saved BOMs

**Requirements:**
- BOM-01: User can save generated BOM to a project
- BOM-02: User can view saved BOMs in a project
- BOM-03: User can edit a saved BOM (quantities, items, visibility)
- BOM-04: User can delete a saved BOM

**Technical Notes:**
- boms and bomItems tables with cascade delete
- Drizzle transactions for atomic BOM+items saves
- Optimistic UI updates for instant feedback
- Nested route /projects/[id]/bom/[bomId]

---

### Phase 11: Template Management

**Goal**: Templates are database-backed and admin-manageable.
**Depends on**: Phase 8 (requires authentication)
**Plans**: 4 plans

Plans:
- [x] 11-01-PLAN.md — Database schema and seed migration
- [x] 11-02-PLAN.md — BOM wizard database integration
- [x] 11-03-PLAN.md — Admin templates list and create
- [x] 11-04-PLAN.md — Admin template edit and delete

**Requirements:**
- TMPL-01: Templates stored in database (migrated from code)
- TMPL-02: User can view all templates in admin panel
- TMPL-03: User can add a new template
- TMPL-04: User can edit an existing template
- TMPL-05: User can delete a template

**Technical Notes:**
- Templates table with JSON columns for joinery options
- Seed script migrated 5 templates from hardcoded file
- BOM wizard fetches templates from database on mount
- Admin routes at /admin/templates with full CRUD

---

### Phase 12: CSV Import

**Goal**: Users can create BOMs from uploaded CSV files.
**Depends on**: Phase 8 (auth), Phase 10 (BOM persistence)
**Plans**: 2 plans

Plans:
- [x] 12-01-PLAN.md — CSV parsing utilities and upload component
- [x] 12-02-PLAN.md — Page integration and round-trip verification

**Requirements:**
- CSV-01: User can upload CSV file to create BOM
- CSV-02: CSV import validates format and shows errors
- CSV-03: Imported BOM can be edited like AI-generated BOM
- CSV-04: Imported BOM can be saved to a project

**Technical Notes:**
- PapaParse library for RFC 4180 CSV parsing
- UTF-8 BOM stripping for Excel compatibility
- Drag-and-drop upload component
- Round-trip compatibility verified (export → re-import)

---

## Phase Dependencies

```
Phase 8: Authentication Foundation
    |-- Phase 9: Project Management
    |       +-- Phase 10: BOM Persistence
    |               +-- Phase 12: CSV Import (also depends on Phase 8)
    +-- Phase 11: Template Management
```

---

## Milestone Summary

**Key Decisions:**
- Custom auth over framework (Lucia deprecated, oslo + Argon2 sufficient)
- Sessions in Turso database (no external cache needed)
- Self-registration (simplest for single-user)
- Templates in database (enables admin CRUD)
- CSV import matches export (round-trip compatibility)
- Optimistic UI pattern for BOM edits (instant feedback)

**Issues Resolved:**
- Transformed single-session MVP into persistent application
- User data isolation with ownership verification
- Full CRUD for projects, BOMs, and templates

**Issues Deferred:**
- Password reset and email verification (v2.1)
- Multi-user support with roles (v3.0)
- OAuth login (v3.0)

**Technical Debt Incurred:**
- 3 INFO-level items (console.log, Svelte state warning, stale import in seed script)

---

*For current project status, see .planning/ROADMAP.md (next milestone)*
*Archived: 2026-01-29*
