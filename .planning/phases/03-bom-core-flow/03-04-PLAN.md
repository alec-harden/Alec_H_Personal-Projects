---
phase: 03-bom-core-flow
plan: 04
type: execute
wave: 2
depends_on: ["03-02", "03-03"]
files_modified:
  - src/lib/components/bom/BOMDisplay.svelte
  - src/lib/components/bom/BOMCategory.svelte
  - src/lib/components/bom/BOMItem.svelte
  - src/routes/bom/new/+page.svelte
  - src/routes/+page.svelte
autonomous: false

must_haves:
  truths:
    - "User can start new BOM from dashboard"
    - "Generated BOM displays in organized category view"
    - "BOM shows all 4 categories with collapsible sections"
    - "Each item displays name, quantity, unit, and optional notes"
    - "User can start over after viewing BOM"
  artifacts:
    - path: "src/lib/components/bom/BOMDisplay.svelte"
      provides: "Main BOM display container"
      min_lines: 40
    - path: "src/lib/components/bom/BOMCategory.svelte"
      provides: "Collapsible category section"
      min_lines: 30
    - path: "src/lib/components/bom/BOMItem.svelte"
      provides: "Individual BOM item row"
      min_lines: 15
    - path: "src/routes/bom/new/+page.svelte"
      provides: "BOM creation page with wizard and display"
      min_lines: 80
  key_links:
    - from: "src/routes/bom/new/+page.svelte"
      to: "/api/bom/generate"
      via: "fetch POST call"
      pattern: "fetch.*api/bom/generate"
    - from: "src/routes/bom/new/+page.svelte"
      to: "BOMWizard.svelte"
      via: "component import"
      pattern: "import.*BOMWizard"
    - from: "src/routes/bom/new/+page.svelte"
      to: "BOMDisplay.svelte"
      via: "component import"
      pattern: "import.*BOMDisplay"
    - from: "src/routes/+page.svelte"
      to: "/bom/new"
      via: "ToolCard href"
      pattern: "href.*bom/new"
---

<objective>
Complete the BOM flow with display components and page integration.

Purpose: Create the final pieces that tie everything together - display components for showing generated BOMs, the main page that integrates wizard and display, and navigation updates to connect from dashboard.

Output: 3 display components, new /bom/new page, and updated dashboard navigation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/02-ai-integration/02-02-SUMMARY.md

# Existing page patterns:
@src/routes/bom/+page.svelte
@src/routes/+page.svelte

# Components from 03-03 (will exist after that plan completes):
# @src/lib/components/bom/BOMWizard.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BOM display components</name>
  <files>src/lib/components/bom/BOMDisplay.svelte, src/lib/components/bom/BOMCategory.svelte, src/lib/components/bom/BOMItem.svelte</files>
  <action>
Create 3 display components for showing the generated BOM:

**1. BOMItem.svelte**
Props: item (BOMItem type)
- Display single row for a BOM item
- Layout: quantity + unit on left, name in center, notes (if any) on right
- Example: "4 pcs | 2x4x8 Pine Board | For table legs"
- Subtle border/separator between items
- Compact but readable styling

**2. BOMCategory.svelte**
Props: category (BOMCategory), items (BOMItem[]), defaultExpanded (boolean, default true)
- Collapsible section with header showing category name
- Category header includes:
  - Expand/collapse chevron icon
  - Category name (capitalize: "Lumber", "Hardware", etc.)
  - Item count badge (e.g., "12 items")
- Body contains list of BOMItem components
- Use Svelte 5 $state() for expanded state
- Smooth expand/collapse animation (optional but nice)
- Category-specific accent colors:
  - Lumber: amber/brown
  - Hardware: slate/gray
  - Finishes: emerald/green
  - Consumables: blue

**3. BOMDisplay.svelte**
Props: bom (BOM type), onStartOver (callback)
- Main container for displaying complete BOM
- Header section:
  - Project name (large, bold)
  - Project type and generation date (smaller, muted)
  - "Start Over" button (calls onStartOver)
- Body: List of BOMCategory components
- Group items by category before rendering
- Order categories: Lumber, Hardware, Finishes, Consumables
- Handle empty BOM gracefully (shouldn't happen but defensive)

Follow existing Tailwind patterns (card styling, amber accents, consistent spacing).
  </action>
  <verify>npm run check passes, all 3 display component files exist</verify>
  <done>BOM display components created with category grouping and collapsible sections</done>
</task>

<task type="auto">
  <name>Task 2: Create /bom/new page with full flow</name>
  <files>src/routes/bom/new/+page.svelte</files>
  <action>
Create the new BOM creation page that integrates wizard and display:

**Page Structure:**
1. Create `src/routes/bom/new/` directory
2. Create `+page.svelte` with the following:

**State Management (using $state):**
- currentView: 'wizard' | 'loading' | 'result'
- generatedBOM: BOM | null
- error: string | null

**Implementation:**
1. Import BOMWizard, BOMDisplay, and types
2. Conditional rendering based on currentView:

   **When 'wizard':**
   - Show page header with back link to dashboard
   - Render BOMWizard component
   - Handle onComplete callback:
     a. Set currentView to 'loading'
     b. POST to /api/bom/generate with project details
     c. On success: set generatedBOM, set currentView to 'result'
     d. On error: set error message, set currentView to 'wizard'

   **When 'loading':**
   - Show loading state with spinner/animation
   - Message: "Generating your bill of materials..."
   - Optional: Show project summary while loading

   **When 'result':**
   - Render BOMDisplay with generatedBOM
   - Handle onStartOver callback:
     a. Reset generatedBOM to null
     b. Set currentView to 'wizard'

3. Error handling:
   - Show error toast/banner if API fails
   - Allow user to retry or go back to wizard

**Page Title:** "New BOM | WoodShop Toolbox"
  </action>
  <verify>npm run build succeeds, page renders without errors at /bom/new</verify>
  <done>/bom/new page integrates wizard, calls API, and displays generated BOM</done>
</task>

<task type="auto">
  <name>Task 3: Update dashboard navigation</name>
  <files>src/routes/+page.svelte</files>
  <action>
Update the dashboard to link to the new BOM wizard:

1. Find the ToolCard for "BOM Generator"
2. Change href from "/bom" to "/bom/new"
3. Optionally update description to mention "guided workflow"

The existing /bom page (chat interface) remains as an alternative/simple mode - don't remove it.

This is a small change - just update the href attribute on the BOM Generator ToolCard.
  </action>
  <verify>Dashboard ToolCard for BOM Generator links to /bom/new</verify>
  <done>Dashboard BOM Generator card navigates to /bom/new wizard</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete BOM generation flow: Dashboard → Wizard → Generate → Display</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:5173
    3. Click "BOM Generator" card on dashboard
    4. Verify: Redirects to /bom/new with wizard interface
    5. Step 1: Select a project template (e.g., "Table")
    6. Step 2: Adjust dimensions if desired, click Next
    7. Step 3: Select at least one joinery method, click Next
    8. Step 4: Choose wood species and finish, click "Generate BOM"
    9. Verify: Loading state appears
    10. Verify: Generated BOM displays with 4 categories
    11. Verify: Each category is collapsible
    12. Verify: Items show quantity, name, and any notes
    13. Click "Start Over" and verify wizard resets
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run check` passes (0 errors, 0 warnings)
- [ ] BOMItem, BOMCategory, BOMDisplay components exist and render
- [ ] /bom/new page loads and shows wizard
- [ ] Wizard completes and triggers BOM generation
- [ ] Loading state displays during generation
- [ ] Generated BOM displays with all 4 categories
- [ ] Categories are collapsible
- [ ] "Start Over" resets to wizard
- [ ] Dashboard links to /bom/new
- [ ] Human verification checkpoint passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Complete flow works end-to-end: Dashboard → Wizard → Generate → Display → Start Over
</success_criteria>

<output>
After completion, create `.planning/phases/03-bom-core-flow/03-04-SUMMARY.md`
</output>
