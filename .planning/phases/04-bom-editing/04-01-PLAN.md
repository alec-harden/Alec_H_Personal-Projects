---
phase: 04-bom-editing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/types/bom.ts
  - src/lib/components/bom/BOMItem.svelte
  - src/lib/components/bom/BOMCategory.svelte
autonomous: true

must_haves:
  truths:
    - "User can click on a quantity to edit it"
    - "Edited quantity updates the display immediately"
    - "Invalid quantities (0 or negative) are rejected"
  artifacts:
    - path: "src/lib/types/bom.ts"
      provides: "BOMItem type with hidden field"
      contains: "hidden?: boolean"
    - path: "src/lib/components/bom/BOMItem.svelte"
      provides: "Editable BOM item with quantity input"
      min_lines: 40
    - path: "src/lib/components/bom/BOMCategory.svelte"
      provides: "Category component passing edit callbacks"
      min_lines: 50
  key_links:
    - from: "BOMItem.svelte"
      to: "BOMCategory.svelte"
      via: "onQuantityChange callback"
      pattern: "onQuantityChange"
---

<objective>
Add type updates and inline quantity editing to BOM items.

Purpose: Enable users to edit material quantities directly in the BOM display (EDIT-01). Also add `hidden` field to BOMItem type to enable parallel work on visibility toggle.

Output: Updated BOMItem type, editable BOMItem component with quantity input, BOMCategory wired with callback.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-bom-core-flow/03-04-SUMMARY.md

# Current implementations:
@src/lib/types/bom.ts
@src/lib/components/bom/BOMItem.svelte
@src/lib/components/bom/BOMCategory.svelte

# Reference for input patterns:
@src/lib/components/bom/DimensionsStep.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update BOMItem type with hidden field</name>
  <files>src/lib/types/bom.ts</files>
  <action>
Add `hidden?: boolean` field to the BOMItem interface. This enables visibility toggle functionality (04-02) to work in parallel.

Update the BOMItem interface:
```typescript
export interface BOMItem {
  id: string;
  name: string;
  description?: string;
  quantity: number;
  unit: string;
  category: BOMCategory;
  notes?: string;
  hidden?: boolean;  // NEW: For EDIT-03 visibility toggle
}
```

Add a comment explaining the field is for Phase 4 editing support.
  </action>
  <verify>npm run check passes with no type errors</verify>
  <done>BOMItem interface includes hidden?: boolean field</done>
</task>

<task type="auto">
  <name>Task 2: Add inline quantity editing to BOMItem</name>
  <files>src/lib/components/bom/BOMItem.svelte</files>
  <action>
Transform BOMItem from read-only display to editable component:

**Props changes:**
- Add `onQuantityChange?: (id: string, quantity: number) => void` callback prop
- Add `editable?: boolean` prop (default: true)

**Implementation:**
1. Add `let editing = $state(false)` for edit mode state
2. Add `let inputValue = $state(item.quantity.toString())` for input value
3. Replace static quantity span with conditional rendering:
   - When NOT editing: Show quantity as clickable span with `cursor-pointer` and subtle hover indicator
   - When editing: Show number input (width ~60px, type="number", min="1")

4. Click handler on quantity span:
   - Set `editing = true`
   - Focus the input

5. Input handlers:
   - onblur: Commit the change if valid, revert if invalid, exit edit mode
   - onkeydown Enter: Same as blur
   - onkeydown Escape: Revert and exit edit mode

6. Validation:
   - Parse input as integer
   - If value <= 0 or NaN, revert to original quantity
   - If valid and different, call `onQuantityChange(item.id, newQuantity)`

7. Styling for input:
   - Small input matching existing font size
   - Subtle border (`border-gray-300`)
   - Focus ring (`focus:ring-amber-500`)
   - Match existing spacing

Follow patterns from DimensionsStep.svelte for input styling consistency.
  </action>
  <verify>npm run check passes, quantity is editable when clicking</verify>
  <done>BOMItem displays editable quantity input on click, commits on blur/Enter</done>
</task>

<task type="auto">
  <name>Task 3: Wire BOMCategory to pass quantity callback</name>
  <files>src/lib/components/bom/BOMCategory.svelte</files>
  <action>
Update BOMCategory to accept and pass through the quantity change callback:

**Props changes:**
Add to Props interface:
```typescript
onQuantityChange?: (id: string, quantity: number) => void;
```

**Implementation:**
1. Destructure new prop with default undefined
2. Pass `onQuantityChange` to each BOMItem component in the loop:
   ```svelte
   <BOMItem {item} {onQuantityChange} />
   ```

The callback will flow from page -> BOMDisplay -> BOMCategory -> BOMItem.
  </action>
  <verify>npm run check passes, callback prop flows through component chain</verify>
  <done>BOMCategory passes onQuantityChange callback to BOMItem children</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run check` passes (0 errors)
- [ ] BOMItem type includes `hidden?: boolean`
- [ ] BOMItem component accepts `onQuantityChange` callback
- [ ] Clicking quantity shows input field
- [ ] Entering valid quantity and blurring calls callback
- [ ] Invalid quantities (0, negative, NaN) revert to original
- [ ] BOMCategory passes callback to children
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Quantity editing works inline (click to edit, blur/Enter to commit)
- Type system updated for visibility feature
</success_criteria>

<output>
After completion, create `.planning/phases/04-bom-editing/04-01-SUMMARY.md`
</output>
