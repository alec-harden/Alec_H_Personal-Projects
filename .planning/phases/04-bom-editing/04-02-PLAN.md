---
phase: 04-bom-editing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/components/bom/BOMItem.svelte
  - src/lib/components/bom/BOMCategory.svelte
autonomous: true

must_haves:
  truths:
    - "User can toggle item visibility via checkbox"
    - "Hidden items appear greyed out with strikethrough"
    - "Category count reflects visible items when some are hidden"
  artifacts:
    - path: "src/lib/components/bom/BOMItem.svelte"
      provides: "BOM item with visibility toggle checkbox"
      contains: "onToggleVisibility"
    - path: "src/lib/components/bom/BOMCategory.svelte"
      provides: "Category with visible item count"
      contains: "onToggleVisibility"
  key_links:
    - from: "BOMItem.svelte"
      to: "BOMCategory.svelte"
      via: "onToggleVisibility callback"
      pattern: "onToggleVisibility"
---

<objective>
Add visibility toggle functionality to BOM items.

Purpose: Enable users to hide/unhide items in the BOM (EDIT-03). Hidden items appear greyed out and will be excluded from export totals in Phase 5.

Output: BOMItem with checkbox and conditional styling, BOMCategory with visibility callback and updated count display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-bom-core-flow/03-04-SUMMARY.md

# Current implementations (will be modified by 04-01 in parallel):
@src/lib/components/bom/BOMItem.svelte
@src/lib/components/bom/BOMCategory.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add visibility toggle to BOMItem</name>
  <files>src/lib/components/bom/BOMItem.svelte</files>
  <action>
Add checkbox toggle for item visibility with conditional styling.

**Note:** 04-01 is modifying this file in parallel. Merge changes carefully - 04-01 adds quantity editing, this adds visibility toggle.

**Props changes:**
Add to Props interface:
```typescript
onToggleVisibility?: (id: string) => void;
```

**Implementation:**

1. Add checkbox at the START of the row (before quantity):
```svelte
{#if onToggleVisibility}
  <input
    type="checkbox"
    checked={!item.hidden}
    onchange={() => onToggleVisibility(item.id)}
    class="h-4 w-4 rounded border-gray-300 text-amber-600 focus:ring-amber-500"
    aria-label="Include in BOM"
  />
{/if}
```

2. Add conditional classes to the row container based on `item.hidden`:
   - When hidden: `opacity-50`
   - Apply to the outer div

3. Add conditional styling to item name when hidden:
   - `line-through` on the name span
   - `text-gray-400` (muted color)

4. Update the flex container structure:
```svelte
<div class="flex items-center justify-between ... {item.hidden ? 'opacity-50' : ''}">
  <div class="flex items-center gap-3">
    {#if onToggleVisibility}
      <input type="checkbox" ... />
    {/if}
    <span class="quantity">...</span>
    <span class="{item.hidden ? 'line-through text-gray-400' : 'text-gray-900'}">{item.name}</span>
  </div>
  ...
</div>
```

5. Checkbox semantics:
   - Checked = item is VISIBLE (included)
   - Unchecked = item is HIDDEN (excluded)
   - This is intuitive: checking "includes" the item
  </action>
  <verify>npm run check passes, checkbox toggles visibility state</verify>
  <done>BOMItem shows checkbox, hidden items display greyed with strikethrough</done>
</task>

<task type="auto">
  <name>Task 2: Update BOMCategory for visibility callback and count</name>
  <files>src/lib/components/bom/BOMCategory.svelte</files>
  <action>
Update BOMCategory to pass visibility callback and show accurate counts.

**Note:** 04-01 is modifying this file in parallel. Merge changes carefully.

**Props changes:**
Add to Props interface:
```typescript
onToggleVisibility?: (id: string) => void;
```

**Implementation:**

1. Destructure new prop with default undefined

2. Pass `onToggleVisibility` to each BOMItem:
```svelte
<BOMItem {item} {onQuantityChange} {onToggleVisibility} />
```

3. Calculate visible item count:
```typescript
const visibleCount = $derived(items.filter(i => !i.hidden).length);
const totalCount = $derived(items.length);
const hasHidden = $derived(visibleCount < totalCount);
```

4. Update the count badge in the header to show both counts when items are hidden:
```svelte
<span class="rounded-full bg-gray-200 px-2.5 py-0.5 text-sm font-medium text-gray-700">
  {#if hasHidden}
    {visibleCount} of {totalCount} items
  {:else}
    {totalCount} {totalCount === 1 ? 'item' : 'items'}
  {/if}
</span>
```

This shows "5 items" normally, but "3 of 5 items" when 2 are hidden.
  </action>
  <verify>npm run check passes, category count reflects visible items</verify>
  <done>BOMCategory passes visibility callback and shows "X of Y items" when some hidden</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run check` passes (0 errors)
- [ ] Checkbox appears at start of each BOM item row
- [ ] Clicking checkbox toggles item.hidden state (via callback)
- [ ] Hidden items have `opacity-50` and `line-through` on name
- [ ] Category badge shows "X of Y items" when some items hidden
- [ ] Category badge shows "X items" when all visible
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Visibility toggle works (checkbox toggles, visual feedback)
- Category counts accurately reflect visible items
</success_criteria>

<output>
After completion, create `.planning/phases/04-bom-editing/04-02-SUMMARY.md`
</output>
