---
phase: 02-ai-integration
plan: 02
type: execute
wave: 1
depends_on: ["02-01"]
files_modified:
  - src/lib/components/ChatMessage.svelte
  - src/lib/components/ChatInput.svelte
  - src/routes/bom/+page.svelte
autonomous: false
must_haves:
  truths:
    - "User can visit /bom and see chat interface"
    - "User can type message and see AI streaming response"
    - "Loading state visible while AI responds"
    - "Messages persist in conversation thread"
  artifacts:
    - path: "src/lib/components/ChatMessage.svelte"
      provides: "Message bubble component"
      min_lines: 20
    - path: "src/lib/components/ChatInput.svelte"
      provides: "Message input with submit"
      min_lines: 25
    - path: "src/routes/bom/+page.svelte"
      provides: "BOM tool page with chat"
      min_lines: 40
  key_links:
    - from: "src/routes/bom/+page.svelte"
      to: "src/lib/components/ChatMessage.svelte"
      via: "import ChatMessage"
      pattern: "import.*ChatMessage"
    - from: "src/routes/bom/+page.svelte"
      to: "@ai-sdk/svelte"
      via: "import { Chat }"
      pattern: "import.*Chat.*@ai-sdk/svelte"
---

<objective>
Build chat UI components and integrate with streaming AI endpoint on the BOM page.

Purpose: Enable users to interact with AI assistant for woodworking project planning via chat interface.
Output: Functional `/bom` page with streaming chat, making the dashboard's BOM Generator link functional.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ai-integration/02-01-SUMMARY.md

Relevant source files:
@src/lib/components/ToolCard.svelte - Pattern for Svelte 5 component props with $props()
@src/lib/components/Header.svelte - Established styling patterns (amber theme)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create chat UI components</name>
  <files>src/lib/components/ChatMessage.svelte, src/lib/components/ChatInput.svelte</files>
  <action>
Create two reusable chat components following established patterns (Svelte 5 $props(), TypeScript interfaces, Tailwind).

1. Create `src/lib/components/ChatMessage.svelte`:
```svelte
<script lang="ts">
  // Chat message bubble component
  // Displays user or assistant messages with appropriate styling

  interface Props {
    role: 'user' | 'assistant';
    content: string;
  }

  let { role, content }: Props = $props();
</script>

<div class="flex {role === 'user' ? 'justify-end' : 'justify-start'} mb-4">
  <div
    class="max-w-[80%] rounded-2xl px-4 py-3 {role === 'user'
      ? 'bg-amber-700 text-white rounded-br-md'
      : 'bg-gray-100 text-gray-900 rounded-bl-md'}"
  >
    {#if role === 'assistant'}
      <span class="text-xs text-gray-500 block mb-1">AI Assistant</span>
    {/if}
    <p class="whitespace-pre-wrap">{content}</p>
  </div>
</div>
```

2. Create `src/lib/components/ChatInput.svelte`:
```svelte
<script lang="ts">
  // Chat input component with submit button
  // Handles message submission and disabled state during AI response

  interface Props {
    onSubmit: (message: string) => void;
    disabled?: boolean;
    placeholder?: string;
  }

  let { onSubmit, disabled = false, placeholder = 'Describe your woodworking project...' }: Props = $props();

  let inputValue = $state('');

  function handleSubmit(e: SubmitEvent) {
    e.preventDefault();
    if (inputValue.trim() && !disabled) {
      onSubmit(inputValue.trim());
      inputValue = '';
    }
  }

  function handleKeydown(e: KeyboardEvent) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      if (inputValue.trim() && !disabled) {
        onSubmit(inputValue.trim());
        inputValue = '';
      }
    }
  }
</script>

<form onsubmit={handleSubmit} class="flex gap-3">
  <textarea
    bind:value={inputValue}
    onkeydown={handleKeydown}
    {placeholder}
    {disabled}
    rows="2"
    class="flex-1 resize-none rounded-xl border border-gray-300 px-4 py-3 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500/20 disabled:bg-gray-50 disabled:text-gray-500"
  ></textarea>
  <button
    type="submit"
    disabled={disabled || !inputValue.trim()}
    class="self-end rounded-xl bg-amber-700 px-6 py-3 font-medium text-white hover:bg-amber-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
  >
    {#if disabled}
      <span class="inline-block animate-pulse">...</span>
    {:else}
      Send
    {/if}
  </button>
</form>
```

Key patterns:
- Use $props() for component props (Svelte 5)
- Use $state() for local reactive state
- TypeScript interfaces for prop types
- Amber color scheme matches Header.svelte
- Tailwind utilities for all styling
  </action>
  <verify>npm run check passes with no TypeScript errors for new components</verify>
  <done>ChatMessage and ChatInput components created with proper TypeScript types and Tailwind styling</done>
</task>

<task type="auto">
  <name>Task 2: Create BOM page with chat integration</name>
  <files>src/routes/bom/+page.svelte</files>
  <action>
Create the BOM tool page at `/bom` with integrated AI chat.

1. Create directory: `src/routes/bom/`

2. Create `src/routes/bom/+page.svelte`:
```svelte
<script lang="ts">
  import { Chat } from '@ai-sdk/svelte';
  import ChatMessage from '$lib/components/ChatMessage.svelte';
  import ChatInput from '$lib/components/ChatInput.svelte';

  const chat = new Chat({});

  function handleSubmit(message: string) {
    chat.append({
      role: 'user',
      content: message
    });
  }

  // Helper to extract text content from message parts
  function getMessageText(message: typeof chat.messages[number]): string {
    return message.parts
      .filter((part): part is { type: 'text'; text: string } => part.type === 'text')
      .map(part => part.text)
      .join('');
  }
</script>

<svelte:head>
  <title>BOM Generator | WoodShop Toolbox</title>
</svelte:head>

<div class="flex flex-col h-[calc(100vh-140px)]">
  <!-- Header -->
  <div class="mb-6">
    <a href="/" class="text-amber-700 hover:text-amber-800 text-sm mb-2 inline-block">&larr; Back to Dashboard</a>
    <h1 class="text-2xl font-bold text-gray-900">BOM Generator</h1>
    <p class="text-gray-600 mt-1">Describe your project and I'll help you create a bill of materials.</p>
  </div>

  <!-- Chat Messages -->
  <div class="flex-1 overflow-y-auto mb-4 pr-2">
    {#if chat.messages.length === 0}
      <div class="text-center text-gray-500 py-12">
        <p class="text-lg mb-2">Start by describing your project</p>
        <p class="text-sm">Example: "I'm building a farmhouse dining table, 72 inches long by 36 inches wide"</p>
      </div>
    {:else}
      {#each chat.messages as message}
        <ChatMessage role={message.role} content={getMessageText(message)} />
      {/each}
    {/if}

    {#if chat.status === 'streaming'}
      <div class="flex justify-start mb-4">
        <div class="bg-gray-100 rounded-2xl rounded-bl-md px-4 py-3">
          <span class="text-xs text-gray-500 block mb-1">AI Assistant</span>
          <span class="inline-flex gap-1">
            <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0ms"></span>
            <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms"></span>
            <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 300ms"></span>
          </span>
        </div>
      </div>
    {/if}

    {#if chat.error}
      <div class="bg-red-50 text-red-700 p-4 rounded-lg mb-4">
        <p class="font-medium">Something went wrong</p>
        <p class="text-sm mt-1">Please check your API key configuration and try again.</p>
      </div>
    {/if}
  </div>

  <!-- Chat Input -->
  <div class="border-t border-gray-200 pt-4">
    <ChatInput
      onSubmit={handleSubmit}
      disabled={chat.status === 'streaming'}
    />
  </div>
</div>
```

This page:
- Uses Chat class from @ai-sdk/svelte for state management
- Imports custom ChatMessage and ChatInput components
- Shows empty state with example prompt
- Displays streaming indicator during AI response
- Shows error state if API call fails
- Matches established layout patterns with amber accent color
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>BOM page exists at /bom with functional chat interface</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Chat UI integrated with streaming AI responses on /bom page</what-built>
  <how-to-verify>
    1. Ensure you have set ANTHROPIC_API_KEY (or OPENAI_API_KEY) in your .env file
    2. Run: npm run dev
    3. Visit: http://localhost:5173
    4. Click the "BOM Generator" card on the dashboard
    5. Verify: Page shows "BOM Generator" title and chat interface
    6. Verify: Empty state shows example prompt text
    7. Type: "I want to build a simple bookshelf" and press Send (or Enter)
    8. Verify: Loading indicator (bouncing dots) appears
    9. Verify: AI response streams in progressively (not all at once)
    10. Verify: User message shows in amber, AI response in gray
    11. Send a follow-up: "What wood would you recommend?"
    12. Verify: Conversation continues with context
    13. Click "Back to Dashboard" link
    14. Verify: Returns to home page
    15. Check browser console: No errors
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run check` passes TypeScript validation
- [ ] ChatMessage component renders user and assistant messages differently
- [ ] ChatInput component handles form submission
- [ ] BOM page at /bom loads without errors
- [ ] Chat messages display with streaming
- [ ] Human verification checkpoint passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- User approved visual layout and streaming behavior
- Chat conversation works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/02-ai-integration/02-02-SUMMARY.md`
</output>
