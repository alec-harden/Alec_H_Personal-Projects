---
phase: 18-cut-optimizer-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/server/schema.ts
  - src/routes/cutlist/+page.svelte
  - src/routes/cutlist/+page.ts
  - src/lib/components/cutlist/ModeSelector.svelte
autonomous: true

must_haves:
  truths:
    - "User can navigate to /cutlist route"
    - "User can toggle between Linear and Sheet modes"
    - "Mode selection persists in component state"
  artifacts:
    - path: "src/lib/server/schema.ts"
      provides: "cutLists, cutListCuts, cutListStock tables"
      contains: "cutLists"
    - path: "src/routes/cutlist/+page.svelte"
      provides: "Main cut optimizer page"
      min_lines: 50
    - path: "src/routes/cutlist/+page.ts"
      provides: "Page load function"
      exports: ["load"]
    - path: "src/lib/components/cutlist/ModeSelector.svelte"
      provides: "Linear/Sheet toggle component"
      min_lines: 30
  key_links:
    - from: "src/routes/cutlist/+page.svelte"
      to: "ModeSelector.svelte"
      via: "component import and binding"
      pattern: "import.*ModeSelector"
---

<objective>
Create database schema for cut lists and scaffold the /cutlist route with mode selection.

Purpose: Establish the data foundation and basic UI shell for the Cut List Optimizer tool. The mode selector (Linear vs Sheet) is fundamental as it determines which input forms and optimization algorithms will be used.

Output: Working /cutlist route with mode toggle, database schema ready for cut list persistence.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-cut-optimizer-foundation/18-RESEARCH.md
@src/lib/server/schema.ts
@src/routes/+page.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cut list database schema</name>
  <files>src/lib/server/schema.ts</files>
  <action>
Add three new tables to the Drizzle schema for cut list persistence:

1. `cutLists` table:
   - `id` (text, primary key)
   - `userId` (text, references users.id with cascade delete)
   - `projectId` (text, nullable, references projects.id with cascade delete) - null until saved to project
   - `name` (text, not null)
   - `mode` (text, enum ['linear', 'sheet'], not null)
   - `kerf` (real, not null, default 0.125) - blade width in inches
   - `createdAt` (integer, timestamp)
   - `updatedAt` (integer, timestamp)

2. `cutListCuts` table:
   - `id` (text, primary key)
   - `cutListId` (text, references cutLists.id with cascade delete)
   - `length` (real, not null) - inches
   - `width` (real, nullable) - inches, only for sheet mode
   - `quantity` (integer, not null, default 1)
   - `label` (text, nullable) - optional name like "Table top"
   - `position` (integer, not null) - for ordering

3. `cutListStock` table:
   - `id` (text, primary key)
   - `cutListId` (text, references cutLists.id with cascade delete)
   - `length` (real, not null) - inches
   - `width` (real, nullable) - inches, only for sheet mode
   - `quantity` (integer, not null, default 1)
   - `label` (text, nullable) - optional name like "8ft pine"
   - `position` (integer, not null) - for ordering

Add Drizzle relations:
- cutLists -> user (many-to-one)
- cutLists -> project (many-to-one, nullable)
- cutLists -> cuts (one-to-many)
- cutLists -> stock (one-to-many)
- cutListCuts -> cutList (many-to-one)
- cutListStock -> cutList (many-to-one)

Follow existing schema patterns (see users, projects, boms tables for reference).
  </action>
  <verify>Run `npm run check` - no TypeScript errors</verify>
  <done>Schema has cutLists, cutListCuts, cutListStock tables with proper relations and cascade deletes</done>
</task>

<task type="auto">
  <name>Task 2: Create /cutlist route scaffold with mode selector</name>
  <files>
    src/routes/cutlist/+page.svelte
    src/routes/cutlist/+page.ts
    src/lib/components/cutlist/ModeSelector.svelte
  </files>
  <action>
Create the cut list optimizer page with mode selection:

**src/routes/cutlist/+page.ts:**
- Export load function that checks for authentication (optional - tool works without auth)
- If authenticated, load user's projects (for save functionality later)
- Return { isAuthenticated, projects }

**src/lib/components/cutlist/ModeSelector.svelte:**
- Props: `mode` (bindable), `onModeChange` callback
- Two toggle buttons: "Linear (1D)" and "Sheet (2D)"
- Use Svelte 5 $props() and $bindable() patterns
- Style with amber theme (selected state uses amber-700 background)
- Include icons: ruler for linear, grid/square for sheet
- Add descriptive subtitles: "Boards, trim, lumber" for linear, "Plywood, panels" for sheet

**src/routes/cutlist/+page.svelte:**
- Import ModeSelector component
- Track mode state with $state<'linear' | 'sheet'>('linear')
- Page header with back link to dashboard, title "Cut List Optimizer"
- Brief description explaining the tool
- ModeSelector component with two-way binding
- Placeholder content area that shows "{mode} mode selected" for now
- Follow same page structure as /bom/new (page-header, back-link patterns)
- Use existing CSS variables and Tailwind classes

Match existing project aesthetic:
- var(--font-display) for titles
- var(--color-walnut) for accent colors
- var(--space-*) for spacing
- sanded-surface class for card backgrounds
  </action>
  <verify>
1. Navigate to http://localhost:5173/cutlist - page loads
2. Click "Linear (1D)" and "Sheet (2D)" toggles - mode switches and UI updates
3. Run `npm run check` - no TypeScript errors
  </verify>
  <done>
- /cutlist route displays page with mode selector
- Mode toggle switches between Linear and Sheet
- Page follows established project styling patterns
  </done>
</task>

</tasks>

<verification>
1. Database schema compiles: `npm run check` passes
2. Route accessible: http://localhost:5173/cutlist loads
3. Mode toggle works: clicking Linear/Sheet updates state
4. Styling consistent: matches existing project aesthetic
</verification>

<success_criteria>
- cutLists, cutListCuts, cutListStock tables defined in schema.ts
- /cutlist route renders with page header and mode selector
- Mode selection is reactive (UI updates when toggled)
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-cut-optimizer-foundation/18-01-SUMMARY.md`
</output>
