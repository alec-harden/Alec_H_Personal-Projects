---
phase: 18-cut-optimizer-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/components/cutlist/CutInputForm.svelte
  - src/lib/components/cutlist/StockInputForm.svelte
  - src/lib/components/cutlist/KerfConfig.svelte
  - src/lib/types/cutlist.ts
autonomous: true

must_haves:
  truths:
    - "User can add new cut entries"
    - "User can edit cut dimensions (length, width for sheet)"
    - "User can remove cut entries"
    - "User can add new stock entries"
    - "User can edit stock dimensions"
    - "User can remove stock entries"
    - "User can configure kerf/blade width"
  artifacts:
    - path: "src/lib/types/cutlist.ts"
      provides: "TypeScript types for cut list data"
      exports: ["Cut", "Stock", "CutListMode"]
    - path: "src/lib/components/cutlist/CutInputForm.svelte"
      provides: "Dynamic cut entry form"
      min_lines: 80
    - path: "src/lib/components/cutlist/StockInputForm.svelte"
      provides: "Dynamic stock entry form"
      min_lines: 80
    - path: "src/lib/components/cutlist/KerfConfig.svelte"
      provides: "Kerf configuration with presets"
      min_lines: 50
  key_links:
    - from: "CutInputForm.svelte"
      to: "src/lib/types/cutlist.ts"
      via: "type import"
      pattern: "import.*Cut.*from"
    - from: "StockInputForm.svelte"
      to: "src/lib/types/cutlist.ts"
      via: "type import"
      pattern: "import.*Stock.*from"
---

<objective>
Create the input form components for cuts, stock, and kerf configuration.

Purpose: These forms are the primary user interaction points for entering cut requirements and available materials. They must handle dynamic arrays (add/remove rows), support both 1D (length only) and 2D (length + width) modes, and validate inputs appropriately.

Output: Three reusable Svelte components that can be composed into the main cut optimizer page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-cut-optimizer-foundation/18-RESEARCH.md
@src/lib/types/bom.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TypeScript types for cut list data</name>
  <files>src/lib/types/cutlist.ts</files>
  <action>
Create type definitions for cut list optimizer:

```typescript
// Optimization modes
export type CutListMode = 'linear' | 'sheet';

// Individual cut entry (what user needs to cut)
export interface Cut {
  id: string;
  length: number;      // inches
  width: number | null; // inches, null for linear mode
  quantity: number;
  label: string;       // optional name
}

// Stock material entry (what's available to cut from)
export interface Stock {
  id: string;
  length: number;      // inches
  width: number | null; // inches, null for linear mode
  quantity: number;
  label: string;       // optional name
}

// Kerf presets for common blade widths
export interface KerfPreset {
  label: string;
  value: number;
}

export const KERF_PRESETS: KerfPreset[] = [
  { label: 'Standard (1/8")', value: 0.125 },
  { label: 'Thin Kerf (3/32")', value: 0.09375 },
  { label: 'Thick Blade (5/32")', value: 0.15625 },
  { label: 'No Kerf', value: 0 }
];

// Helper to create a new cut with defaults
export function createCut(mode: CutListMode): Cut {
  return {
    id: crypto.randomUUID(),
    length: 0,
    width: mode === 'sheet' ? 0 : null,
    quantity: 1,
    label: ''
  };
}

// Helper to create a new stock with defaults
export function createStock(mode: CutListMode): Stock {
  return {
    id: crypto.randomUUID(),
    length: 0,
    width: mode === 'sheet' ? 0 : null,
    quantity: 1,
    label: ''
  };
}

// Validation helpers
export function isValidCut(cut: Cut, mode: CutListMode): boolean {
  if (cut.length <= 0) return false;
  if (cut.quantity < 1) return false;
  if (mode === 'sheet' && (cut.width === null || cut.width <= 0)) return false;
  return true;
}

export function isValidStock(stock: Stock, mode: CutListMode): boolean {
  if (stock.length <= 0) return false;
  if (stock.quantity < 1) return false;
  if (mode === 'sheet' && (stock.width === null || stock.width <= 0)) return false;
  return true;
}
```
  </action>
  <verify>Run `npm run check` - no TypeScript errors</verify>
  <done>Type file exports Cut, Stock, CutListMode, KERF_PRESETS, and helper functions</done>
</task>

<task type="auto">
  <name>Task 2: Create cut and stock input form components</name>
  <files>
    src/lib/components/cutlist/CutInputForm.svelte
    src/lib/components/cutlist/StockInputForm.svelte
  </files>
  <action>
Create dynamic array input forms for cuts and stock:

**CutInputForm.svelte:**
- Props using $props():
  - `cuts`: Cut[] (bindable)
  - `mode`: CutListMode
- Section header "Required Cuts" with "Add Cut" button
- For each cut in array (keyed by cut.id):
  - Length input: number, step="0.125", placeholder="Length (in)", min="0"
  - Width input (sheet mode only): number, step="0.125", placeholder="Width (in)", min="0"
  - Quantity input: number, step="1", min="1"
  - Label input: text, placeholder="Label (optional)"
  - Remove button with trash icon
- Use bind:value for direct mutation (Svelte 5 reactivity)
- addCut() function using createCut(mode) helper
- removeCut(id) function filters array
- Empty state message when cuts.length === 0
- Grid layout: length | width (if sheet) | qty | label | remove

**StockInputForm.svelte:**
- Same structure as CutInputForm but for Stock
- Section header "Available Stock" with "Add Stock" button
- Same input fields (length, width for sheet, quantity, label)
- Use createStock(mode) helper
- Empty state: "Add at least one stock piece"

Styling requirements:
- Use existing form input styles from project
- Input rows in a grid with consistent spacing
- Remove button styled as icon button (ghost style)
- Mobile responsive: stack fields on narrow screens
- Use var(--color-*) and var(--space-*) CSS variables
  </action>
  <verify>
1. Create test harness or add components to /cutlist page temporarily
2. Add cut entries - rows appear
3. Remove cut entries - rows disappear
4. Change mode - width field shows/hides
5. Run `npm run check` - no TypeScript errors
  </verify>
  <done>
- CutInputForm renders dynamic cut entries with add/remove
- StockInputForm renders dynamic stock entries with add/remove
- Width field conditionally shown based on mode
- All inputs properly bound to state
  </done>
</task>

<task type="auto">
  <name>Task 3: Create kerf configuration component</name>
  <files>src/lib/components/cutlist/KerfConfig.svelte</files>
  <action>
Create kerf (blade width) configuration component:

**KerfConfig.svelte:**
- Props using $props():
  - `kerf`: number (bindable)
- Compact horizontal layout
- Label: "Blade Width (Kerf)"
- Number input: step="0.0625" (1/16"), min="0", max="0.5"
- Preset buttons row using KERF_PRESETS from types
- Active preset highlighted (check if kerf matches preset.value)
- Help text: "Material removed by the saw blade. Standard table saw: 1/8""

Styling:
- Preset buttons: small, pill-shaped
- Active state: amber-700 background, white text
- Inactive state: paper-dark background, muted text
- Input and presets on same row (flex layout)
- Responsive: stack on narrow screens

Behavior:
- Clicking preset sets kerf to preset value
- Manual input allows any valid decimal
- Input value updates preset button active state
  </action>
  <verify>
1. Component renders with default kerf (0.125)
2. Click preset buttons - kerf value updates
3. Manual input - value changes, preset highlights if matching
4. Run `npm run check` - no TypeScript errors
  </verify>
  <done>
- KerfConfig shows input field and preset buttons
- Clicking preset updates kerf value
- Manual input works with proper step increments
- Active preset visually highlighted
  </done>
</task>

</tasks>

<verification>
1. Types compile: `npm run check` passes
2. Components render: Add to test page, verify display
3. Dynamic arrays work: Add/remove cuts and stock
4. Mode switching: Width field shows/hides correctly
5. Kerf presets: Clicking updates value
</verification>

<success_criteria>
- Cut, Stock, CutListMode types defined and exported
- CutInputForm handles dynamic cut array with add/remove
- StockInputForm handles dynamic stock array with add/remove
- KerfConfig shows input with preset buttons
- Components properly typed with Svelte 5 $props()
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-cut-optimizer-foundation/18-02-SUMMARY.md`
</output>
