# 29-02: Admin UI

---
wave: 2
depends_on: [29-01]
files_modified:
  - src/routes/admin/dimensions/+page.server.ts
  - src/routes/admin/dimensions/+page.svelte
  - src/lib/components/UserMenu.svelte
autonomous: true
---

## Objective

Create admin UI for managing dimension values with view, add, remove, and reset functionality.

## Requirements

- ADM-03: Create `/admin/dimensions` route for dimension management UI
- ADM-04: Admin can view current accepted values per category/dimension type
- ADM-05: Admin can add new accepted values
- ADM-06: Admin can remove accepted values
- ADM-07: Admin can reset dimension values to defaults

## must_haves

- [ ] /admin/dimensions route exists and is admin-protected
- [ ] Page displays all dimension values grouped by category and type
- [ ] Admin can add new dimension values via form
- [ ] Admin can remove dimension values via button
- [ ] Reset to Defaults button reseeds original values
- [ ] UserMenu has link to Manage Dimensions for admins
- [ ] Non-admin users get 403 error

## Tasks

<task id="1">
**Create +page.server.ts**

Create admin page server logic following pattern from admin/templates:

```typescript
import { requireAdmin } from '$lib/server/auth';
import { db } from '$lib/server/db';
import { dimensionValues } from '$lib/server/schema';
import { eq, and, asc, sql } from 'drizzle-orm';
import { fail, redirect } from '@sveltejs/kit';
import { invalidateDimensionCache } from '$lib/utils/dimension-validation';
import { seedDefaultDimensions } from '$lib/server/seed-dimensions';
import type { PageServerLoad, Actions } from './$types';
```

Load function:
- requireAdmin(event)
- Query all dimensions ordered by category, dimensionType, value
- Group by category and type for UI display
- Return { dimensions: grouped }

Actions:
- add: validate inputs, check duplicate (with tolerance), insert, invalidateCache
- remove: delete by id, invalidateCache
- reset: delete all, reseed, invalidateCache, redirect (PRG)

File: [src/routes/admin/dimensions/+page.server.ts](src/routes/admin/dimensions/+page.server.ts) (NEW)
</task>

<task id="2">
**Create +page.svelte**

Create admin UI following amber theme from admin/users:

Structure:
- Header: "Dimension Management" title with back link
- Error/success message display
- Three category sections (Hardwood, Common, Sheet)
- Each category card shows dimension types (Thickness, Width, Length)
- Values displayed as chips with remove (x) button
- "Add" button per dimension type opens inline form
- Form has number input and submit button
- Reset to Defaults button at bottom with confirm dialog

Styling:
- Use amber-700/amber-800 for buttons and accents
- Stone colors for text and backgrounds
- Responsive grid layout
- Chip display for values with hover states

Svelte 5 patterns:
- Use $props() and $state()
- Form actions with use:enhance
- Fractional display helper for common values

File: [src/routes/admin/dimensions/+page.svelte](src/routes/admin/dimensions/+page.svelte) (NEW)
</task>

<task id="3">
**Add nav link to UserMenu.svelte**

In the admin section of UserMenu (after "Manage Templates" link), add:

```svelte
<a
  href="/admin/dimensions"
  class="block px-4 py-2 text-sm text-stone-700 hover:bg-stone-100 hover:text-amber-800"
>
  Manage Dimensions
</a>
```

File: [src/lib/components/UserMenu.svelte](src/lib/components/UserMenu.svelte)
</task>

## Verification

1. Access /admin/dimensions as admin - page loads
2. Access /admin/dimensions as non-admin - 403 error
3. All 41 default values visible, grouped by category
4. Add custom value (e.g., 2.5" hardwood thickness) - appears in list
5. Remove the custom value - disappears from list
6. Click "Reset to Defaults" - custom values removed, defaults restored
7. UserMenu shows "Manage Dimensions" link for admins
8. Form validation prevents empty or invalid values
9. Duplicate values show error message
