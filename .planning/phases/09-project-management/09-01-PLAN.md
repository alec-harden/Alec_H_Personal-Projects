---
phase: 09-project-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/server/schema.ts
autonomous: true

must_haves:
  truths:
    - "Projects table has userId foreign key to users table"
    - "Projects table has description and notes columns"
    - "Database schema is synchronized with code"
  artifacts:
    - path: "src/lib/server/schema.ts"
      provides: "Extended projects table with userId, description, notes"
      contains: "userId.*references.*users.id"
  key_links:
    - from: "projects.userId"
      to: "users.id"
      via: "foreign key reference"
      pattern: "references.*users\\.id.*onDelete.*cascade"
---

<objective>
Extend the projects table schema with user ownership and metadata fields.

Purpose: Enable user-scoped project management by adding userId foreign key and description/notes fields to the existing projects table.
Output: Updated schema.ts with extended projects table and Drizzle relations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-project-management/09-RESEARCH.md
@src/lib/server/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend projects table with userId and metadata</name>
  <files>src/lib/server/schema.ts</files>
  <action>
Update the projects table definition to add:

1. `userId` column: text, notNull, references users.id with onDelete: 'cascade'
2. `description` column: text, nullable
3. `notes` column: text, nullable

The existing columns (id, name, createdAt, updatedAt) remain unchanged.

Add Drizzle relations:
- `projectsRelations`: one-to-one relation to users (user field)
- Update `usersRelations`: add `many(projects)` to create bidirectional relation

Follow the exact pattern from sessionsRelations for the foreign key reference.

Schema should look like:
```typescript
export const projects = sqliteTable('projects', {
    id: text('id').primaryKey(),
    userId: text('user_id')
        .notNull()
        .references(() => users.id, { onDelete: 'cascade' }),
    name: text('name').notNull(),
    description: text('description'),
    notes: text('notes'),
    createdAt: integer('created_at', { mode: 'timestamp' }).notNull(),
    updatedAt: integer('updated_at', { mode: 'timestamp' }).notNull()
});

export const projectsRelations = relations(projects, ({ one }) => ({
    user: one(users, {
        fields: [projects.userId],
        references: [users.id]
    })
}));
```

And update usersRelations:
```typescript
export const usersRelations = relations(users, ({ many }) => ({
    sessions: many(sessions),
    projects: many(projects)
}));
```
  </action>
  <verify>
Run `npm run check` to verify TypeScript compiles without errors.
  </verify>
  <done>
Schema file contains projects table with userId FK and description/notes columns, plus projectsRelations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Push schema changes to database</name>
  <files>drizzle/*</files>
  <action>
Run database schema push to synchronize the SQLite database with the updated schema:

```bash
npm run db:push
```

This will add the new columns to the projects table. Since the table may have existing data (from v1.0 testing), the push should handle migration gracefully.

If there are existing projects without userId, they will need to be deleted or assigned a userId. For development, it's acceptable to recreate the database if needed.
  </action>
  <verify>
Verify schema sync succeeded by running:
```bash
npm run db:studio
```
And confirming the projects table shows userId, description, and notes columns.
  </verify>
  <done>
Database schema matches TypeScript schema - projects table has all required columns.
  </done>
</task>

</tasks>

<verification>
1. `npm run check` passes (TypeScript valid)
2. `npm run db:push` completes without error
3. Projects table has columns: id, user_id, name, description, notes, created_at, updated_at
</verification>

<success_criteria>
- Projects table extended with userId foreign key referencing users.id
- Projects table has nullable description and notes columns
- Drizzle relations defined for projects <-> users
- Database schema synchronized
</success_criteria>

<output>
After completion, create `.planning/phases/09-project-management/09-01-SUMMARY.md`
</output>
