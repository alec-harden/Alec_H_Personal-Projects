---
phase: 09-project-management
plan: 03
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - src/routes/+page.server.ts
  - src/routes/+page.svelte
autonomous: true

must_haves:
  truths:
    - "Authenticated users see their real projects on dashboard"
    - "Unauthenticated users see sample projects (demo mode)"
    - "Dashboard project cards link to /projects/[id]"
    - "New Project button links to /projects for authenticated users"
  artifacts:
    - path: "src/routes/+page.server.ts"
      provides: "Dashboard server load with user projects"
      exports: ["load"]
    - path: "src/routes/+page.svelte"
      provides: "Dashboard displaying real or sample projects"
      contains: "data.projects"
  key_links:
    - from: "src/routes/+page.server.ts"
      to: "db.query.projects"
      via: "conditional load for authenticated users"
      pattern: "locals\\.user.*projects\\.findMany"
    - from: "src/routes/+page.svelte"
      to: "ProjectCard"
      via: "rendering projects from server data"
      pattern: "each.*data\\.projects"
---

<objective>
Integrate project management into the main dashboard.

Purpose: Display user's real projects on the home page when authenticated, providing a seamless entry point to project management.
Output: Dashboard shows real projects with links to /projects/[id], or sample projects for unauthenticated visitors.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-project-management/09-02-SUMMARY.md
@src/routes/+page.svelte
@src/routes/+layout.server.ts
@src/lib/components/ProjectCard.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add server load to fetch user's projects</name>
  <files>src/routes/+page.server.ts</files>
  <action>
Create a server load function for the dashboard that fetches the authenticated user's projects.

**+page.server.ts:**

```typescript
import type { PageServerLoad } from './$types';
import { db } from '$lib/server/db';
import { projects } from '$lib/server/schema';
import { eq, desc } from 'drizzle-orm';

export const load: PageServerLoad = async ({ locals }) => {
    // If user is authenticated, load their projects
    if (locals.user) {
        const userProjects = await db.query.projects.findMany({
            where: eq(projects.userId, locals.user.id),
            orderBy: [desc(projects.updatedAt)],
            limit: 6  // Limit to recent projects for dashboard
        });

        return {
            projects: userProjects,
            isAuthenticated: true
        };
    }

    // Not authenticated - return empty (page will show sample projects)
    return {
        projects: [],
        isAuthenticated: false
    };
};
```

This provides:
- User's recent projects when authenticated (limit 6 for dashboard display)
- Empty array when not authenticated (sample projects shown client-side)
- `isAuthenticated` flag to control UI behavior
  </action>
  <verify>
Run `npm run check` to verify TypeScript compiles.
  </verify>
  <done>
Dashboard server load returns user's projects when authenticated, empty array otherwise.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update dashboard to display real projects</name>
  <files>src/routes/+page.svelte</files>
  <action>
Update the dashboard page to show real projects for authenticated users.

Key changes:

1. **Add `$props()` to receive server data:**
```typescript
let { data } = $props();
```

2. **Conditional project display:**
- If `data.isAuthenticated` and `data.projects.length > 0`: Show user's real projects
- If `data.isAuthenticated` and `data.projects.length === 0`: Show empty state with CTA
- If not authenticated: Show sample projects (existing behavior)

3. **Update "Active Builds" section header:**
- For authenticated users: Link "New Project" to `/projects` (where create form is)
- Section title: "My Projects" for authenticated, "Active Builds" for demo

4. **Update ProjectCard usage:**
- Pass `href="/projects/${project.id}"` for real projects
- Map project data: name, type (use "Project" as default), progress (0 for now - Phase 10 will add BOMs), lastUpdated

5. **Empty state for authenticated users with no projects:**
```svelte
{#if data.isAuthenticated && data.projects.length === 0}
    <div class="empty-state">
        <p>You haven't created any projects yet.</p>
        <a href="/projects" class="btn-primary">Create Your First Project</a>
    </div>
{/if}
```

6. **Keep sample projects for non-authenticated visitors:**
The existing sampleProjects array stays, but only displays when `!data.isAuthenticated`.

7. **Update "Start New Build" card:**
- For authenticated: Link to `/projects`
- For non-authenticated: Keep linking to `/bom/new` (quick demo flow)

Important: The ProjectCard component expects `progress` prop. For now, pass 0 since BOMs aren't persisted yet. Phase 10 will calculate real progress.
  </action>
  <verify>
1. Start dev server: `npm run dev`
2. Visit http://localhost:5173/ while NOT logged in
3. Verify sample projects still display (Farmhouse Dining Table, etc.)
4. Log in and return to home page
5. Verify "My Projects" section shows your real projects
6. If no projects, verify empty state with "Create Your First Project" CTA
7. Click on a project card, verify it links to /projects/[id]
8. Verify "New Project" action links to /projects
  </verify>
  <done>
Dashboard shows real projects for authenticated users, sample projects for visitors, with appropriate CTAs.
  </done>
</task>

</tasks>

<verification>
1. Unauthenticated visitors see sample projects and can explore BOM tool
2. Authenticated users see their projects (or empty state)
3. Project cards link to /projects/[id] for real projects
4. "New Project" action links to /projects for authenticated users
5. No regression in existing dashboard functionality
</verification>

<success_criteria>
- Dashboard displays user's real projects when logged in
- Empty state shows helpful CTA when user has no projects
- Sample projects shown for demo/unauthenticated users
- Navigation flows naturally between dashboard and project management
</success_criteria>

<output>
After completion, create `.planning/phases/09-project-management/09-03-SUMMARY.md`
</output>
