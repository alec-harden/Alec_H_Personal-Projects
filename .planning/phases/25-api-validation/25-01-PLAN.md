# Plan 25-01: API Validation Core

---
wave: 1
depends_on: []
files_modified:
  - src/lib/server/bom-validation.ts (NEW)
  - src/lib/utils/dimension-validation.ts
  - src/routes/api/bom/save/+server.ts
  - src/routes/api/bom/[id]/items/[itemId]/+server.ts
autonomous: true
---

## Objective

Add dimension validation to BOM save/update endpoints, auto-set `cutItem` based on category, return warnings for non-standard dimensions.

## Requirements

- VAL-01/DIM-03: Validate dimensions present when saving items with cutItem=true
- VAL-02/DIM-04: Validate dimension values against allowed lists (warn, don't block)
- VAL-03: Auto-set `cutItem` based on category when saving BOM items

## Tasks

<task id="1">
Create src/lib/server/bom-validation.ts with:
- ValidationWarning interface (itemId, itemName, field, message)
- validateBOMItemDimensions() - returns warnings for missing/non-standard dimensions
- shouldBeCutItem(category) - returns true for lumber categories
</task>

<task id="2">
Export isStandardValue function from src/lib/utils/dimension-validation.ts
</task>

<task id="3">
Update src/routes/api/bom/save/+server.ts:
- Import isLumberCategory and validateBOMItemDimensions
- Auto-set cutItem: isLumberCategory(item.category) for each item
- Collect dimension validation warnings
- Return extended response: { success, bomId, warnings? }
</task>

<task id="4">
Update src/routes/api/bom/[id]/items/[itemId]/+server.ts:
- Add cutItem to updatable fields
- Support both height and thickness (sync both fields)
- Validate dimensions after update
- Return warnings in response
</task>

## Verification

<must_have>
- Build passes (npm run build)
- BOM save auto-sets cutItem for hardwood/common/sheet categories
- BOM save returns warnings for missing dimensions on lumber items
- BOM save returns warnings for non-standard dimensions
- Item update supports cutItem field changes
- Item update returns dimension warnings
</must_have>
