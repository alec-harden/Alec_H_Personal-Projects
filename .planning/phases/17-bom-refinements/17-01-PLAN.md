---
phase: 17-bom-refinements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/server/schema.ts
  - src/lib/types/bom.ts
  - src/lib/components/bom/BOMItem.svelte
autonomous: true

must_haves:
  truths:
    - "Visibility toggle shows eye icon instead of checkbox"
    - "Open eye icon indicates visible item"
    - "Closed eye icon indicates hidden item"
    - "Database schema supports lumber dimension storage"
  artifacts:
    - path: "src/lib/server/schema.ts"
      provides: "bomItems table with length, width, height columns"
      contains: "length: real"
    - path: "src/lib/types/bom.ts"
      provides: "BOMItem type with dimension fields"
      contains: "length?: number"
    - path: "src/lib/components/bom/BOMItem.svelte"
      provides: "Eye icon toggle replacing checkbox"
      contains: "eye"
  key_links:
    - from: "src/lib/types/bom.ts"
      to: "src/lib/server/schema.ts"
      via: "matching nullable dimension fields"
      pattern: "length.*width.*height"
---

<objective>
Add lumber dimension schema and replace visibility checkbox with eye icons.

Purpose: Enable dimension tracking for lumber items and improve visibility toggle UX with intuitive eye icons.
Output: Updated schema with dimension columns, BOMItem type with dimension fields, eye icon visibility toggle.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/server/schema.ts
@src/lib/types/bom.ts
@src/lib/components/bom/BOMItem.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dimension columns to schema and type</name>
  <files>src/lib/server/schema.ts, src/lib/types/bom.ts</files>
  <action>
1. In `src/lib/server/schema.ts`, add three nullable real columns to bomItems table:
   - `length: real('length')` - nullable, for lumber length in inches
   - `width: real('width')` - nullable, for lumber width in inches
   - `height: real('height')` - nullable, for lumber height/thickness in inches

   Add after the `position` column. Use real() not integer() since dimensions may have decimals (e.g., 0.75" for 3/4").

2. In `src/lib/types/bom.ts`, add optional dimension fields to BOMItem interface:
   ```typescript
   length?: number;   // inches (for lumber)
   width?: number;    // inches (for lumber)
   height?: number;   // inches (for lumber, typically thickness)
   ```

   Add comment explaining these are for lumber items only.

3. Run `npm run db:push` to apply schema changes.
  </action>
  <verify>
    - `npm run db:push` completes without errors
    - `npm run check` passes with no type errors
    - Schema shows new columns: `grep -n "length\|width\|height" src/lib/server/schema.ts`
  </verify>
  <done>
    - bomItems table has length, width, height nullable real columns
    - BOMItem type has optional length, width, height number fields
    - Database schema pushed successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace checkbox with eye icon toggle</name>
  <files>src/lib/components/bom/BOMItem.svelte</files>
  <action>
Replace the checkbox visibility toggle with eye icon buttons in BOMItem.svelte:

1. Remove the checkbox-based toggle (lines 69-86 with checkbox-wrapper, checkbox-input, checkbox-custom).

2. Replace with an eye icon button:
   ```svelte
   {#if onToggleVisibility}
     <button
       type="button"
       onclick={() => onToggleVisibility(item.id)}
       class="visibility-toggle"
       aria-label={item.hidden ? 'Show item' : 'Hide item'}
       title={item.hidden ? 'Show item' : 'Hide item'}
     >
       {#if item.hidden}
         <!-- Eye off icon (closed/hidden) -->
         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="eye-icon">
           <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
         </svg>
       {:else}
         <!-- Eye open icon (visible) -->
         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="eye-icon">
           <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
           <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
         </svg>
       {/if}
     </button>
   {/if}
   ```

3. Update styles - remove checkbox styles and add eye icon styles:
   ```css
   /* Visibility Toggle - Eye Icon */
   .visibility-toggle {
     display: flex;
     align-items: center;
     justify-content: center;
     width: 28px;
     height: 28px;
     padding: 0;
     background: none;
     border: none;
     border-radius: var(--radius-sm);
     cursor: pointer;
     transition: all var(--transition-fast);
     color: var(--color-ink-muted);
   }

   .visibility-toggle:hover {
     background: rgba(93, 64, 55, 0.08);
     color: var(--color-walnut);
   }

   .visibility-toggle:focus {
     outline: none;
     box-shadow: 0 0 0 2px rgba(93, 64, 55, 0.2);
   }

   .eye-icon {
     width: 18px;
     height: 18px;
   }

   .item-hidden .visibility-toggle {
     color: var(--color-ink-muted);
     opacity: 0.6;
   }
   ```

4. Remove all checkbox-related CSS (.checkbox-wrapper, .checkbox-input, .checkbox-custom, etc.)
  </action>
  <verify>
    - `npm run check` passes
    - `npm run dev` and navigate to a BOM with items
    - Verify eye icon shows open (visible) or closed/struck-through (hidden)
    - Clicking toggles between states
    - Hidden items still show greyed styling
  </verify>
  <done>
    - Visibility toggle uses eye icon button instead of checkbox
    - Open eye = visible, closed eye with slash = hidden
    - Proper hover/focus states on button
    - Accessibility labels for screen readers
  </done>
</task>

</tasks>

<verification>
1. Schema verification:
   - `npm run db:push` succeeds
   - `npm run check` passes

2. Visual verification:
   - Visit /projects/{id}/boms/{bomId} with existing BOM
   - Eye icons render correctly (open for visible, slashed for hidden)
   - Clicking eye toggles visibility
   - Hidden items show greyed/struck-through styling

3. Type verification:
   - BOMItem type includes optional dimension fields
   - No TypeScript errors in IDE
</verification>

<success_criteria>
1. bomItems table has length, width, height nullable real columns
2. BOMItem type has optional length, width, height number fields
3. Visibility toggle shows open eye (visible) or closed eye with slash (hidden)
4. Clicking eye icon toggles item visibility
5. All existing functionality preserved (quantity edit, add item, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/17-bom-refinements/17-01-SUMMARY.md`
</output>
